class h{static async perform(e,a,t,n){await this[e.action](e,a,t,n)}static async load(e,a,t,n){const r=await crs.process.getValue(e.args.dialog,a,t,n),i=await crs.process.getValue(e.args.return_content,a,t,n);if(r==!0){const o=await w(e);let s=[];for(const c of o){const u=await d(c.name);let g=c;i===!0&&(g=await v(c)),s.push({name:u.name,ext:u.ext,type:c.type,size:c.size,value:g})}return e.args.target!=null&&await crs.process.setValue(e.args.target,s,a,t,n),s}else{const o=await y(e,a,t,n);return e.args.target!=null&&await crs.process.setValue(e.args.target,o,a,t,n),o}}static async save(e,a,t,n){const r=await crs.process.getValue(e.args.details,a,t,n);let i=document.createElement("a");i.style.display="none",document.body.appendChild(i);for(let o of r){let s=new Blob([o.value],{type:o.type}),c=window.URL.createObjectURL(s);i.href=c,i.download=`${o.name}.${o.ext}`,i.click(),window.URL.revokeObjectURL(c),c=null,s=null}i.parentElement.removeChild(i),i=null}static async save_canvas(e,a,t,n){const r=await crs.dom.get_element(e.args.source),i=await crs.process.getValue(e.args.name,a,t,n)||"image",o=r.toDataURL("image/png");let s=document.createElement("a");s.style.display="none",document.body.appendChild(s),s.href=o.replace("image/png","image/octet-stream"),s.download=`${i}.png`,s.click(),s.parentElement.removeChild(s),s=null}static async enable_dropzone(e,a,t,n){const r=await crs.dom.get_element(e.args.element,a,t,n),i=await crs.process.getValue(e.args.callback,a,t,n),o=await crs.process.getValue(e.args.drop_template,a,t,n),s=await crs.process.getValue(e.args.drop_classes,a,t,n);r.addEventListener("drop",p),r.addEventListener("dragenter",_),r.addEventListener("dragover",f),r.addEventListener("dragleave",m),r.__callback=i,r.__dropTemplate=o,r.__highlighted=!1,r.__dropClasses=s}static async disable_dropzone(e,a,t,n){const r=await crs.dom.get_element(e.args.element,a,t,n);r.removeEventListener("drop",p),r.removeEventListener("dragenter",_),r.removeEventListener("dragover",f),r.removeEventListener("dragleave",m),await crs.call("dom_interactive","remove_animation_layer"),delete r.__callback,delete r.__dropTemplate,delete r.__highlighted,delete r.__dropClasses,delete r.__dropBounds}}class b{static async blob(e){return new Promise(a=>{const t=new FileReader;t.onload=()=>{t.onload=null,a(t.result)},t.readAsArrayBuffer(e)})}}async function d(l){const e=l.split("/"),t=e[e.length-1].split("."),n=t[t.length-1];return{name:t[0],ext:n}}async function w(){return new Promise(l=>{let e=document.createElement("input");e.type="file",e.setAttribute("multiple","multiple"),e.onchange=()=>{e.onchange=null;const a=Array.from(e.files);l(a)},e.click()})}async function y(l,e,a,t){const n=await crs.process.getValue(l.args.files,e,a,t),r=[];for(const i of n){const o=await d(i);r.push({name:o.name,ext:o.ext,value:await fetch(i).then(s=>s.blob())})}return r}async function _(l){l.preventDefault();const e=l.currentTarget;e.__highlighted!==!0&&(await crs.call("dom_interactive","highlight",{target:e,template:e.__dropTemplate,classes:e.__dropClasses}),e.__highlighted=!0),e.__dropBounds=e.getBoundingClientRect(),e.__callback({action:"dragEnter",event:l})}async function f(l){l.preventDefault()}async function m(l){l.preventDefault();const e=l.currentTarget,a=l.currentTarget.__dropBounds;a!=null&&(l.x>=a.left&&l.x<=a.right&&l.y>=a.top&&l.y<=a.bottom||(await crs.call("dom_interactive","remove_animation_layer"),e.__highlighted=!1,e.__callback({action:"dragLeave",event:l})))}async function p(l){l.preventDefault();const e=l.currentTarget;await crs.call("dom_interactive","remove_animation_layer"),e.__highlighted=!1;const a=l.dataTransfer.files,t=[];for(const n of a){const r=await d(n.name);t.push({type:n.type,name:r.name,ext:r.ext,size:n.size,value:n})}e.__callback({action:"drop",event:l,results:t})}function v(l){return new Promise((e,a)=>{const t=new FileReader;t.onload=function(n){const r=n.target.result;e(r)},t.onerror=function(n){a(n.target.error)},t.readAsText(l)})}crs.intent.files=h;export{b as FileFormatter,h as FilesActions,d as get_file_name,y as get_files};
